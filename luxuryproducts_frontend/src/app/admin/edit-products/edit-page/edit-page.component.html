<div class="product-detail-container" *ngIf="product()">
  <!-- Existing Variation Selection -->
  <div *ngFor="let name of variationNames()" class="variation-group">
    <span class="variation-label">{{ name }}:</span>
    <div class="variation-buttons">
      <button
        *ngFor="let option of getFilteredOptions(name)"
        (click)="onSelectValue(name, option)"
        [class.selected]="selectedValues[name] === option"
        type="button"
      >
        {{ option }}
      </button>
    </div>
  </div>

  <!-- Selected Variation Details -->
  <div
    class="product-display"
    *ngIf="selectedVariation && selectedVariation.stock >= 0"
  >
    <img
      [src]="selectedVariation.imageUrl"
      [alt]="selectedVariation.sku"
      class="product-image"
    />

    <div class="product-info">
      <label>
        Price (€):
        <input
          type="number"
          [(ngModel)]="selectedVariation.price"
          step="0.01"
        />
      </label>

      <label>
        Stock:
        <input type="number" [(ngModel)]="selectedVariation.stock" />
      </label>

      <label>
        Image URL:
        <input type="text" [(ngModel)]="selectedVariation.imageUrl" />
      </label>

      <div *ngFor="let val of selectedVariation.values">
        <label>
          {{ val.variation.variationName }}:
          <input [(ngModel)]="val.value" />
        </label>
      </div>

      <button (click)="saveVariationChanges()">Save</button>
      <button (click)="deleteVariation(selectedVariation.productVariationId)">
        Delete Variation
      </button>
    </div>
  </div>

  <hr />

  <!-- Toggle Button to Create New Variation -->
  <button (click)="toggleCreateForm()" type="button">
    {{ showCreateForm ? 'Cancel' : 'Create New Variation' }}
  </button>

  <!-- New Variation Form -->
  <div *ngIf="showCreateForm" class="new-variation-form">
    <h3>Create New Variation</h3>

    <label>
      SKU:
      <input type="text" [(ngModel)]="newVariation.sku" />
    </label>

    <label>
      Price (€):
      <input type="number" [(ngModel)]="newVariation.price" step="0.01" />
    </label>

    <label>
      Stock:
      <input type="number" [(ngModel)]="newVariation.stock" />
    </label>

    <label>
      Image URL:
      <input type="text" [(ngModel)]="newVariation.imageUrl" />
    </label>

    <!-- Dynamic Fields for Variation Name/Value Pairs -->
    <div *ngFor="let val of newVariation.values; let i = index">
      <label>
        Variation Name:
        <input [(ngModel)]="val.variation.variationName" />
      </label>

      <label>
        Value:
        <input [(ngModel)]="val.value" />
      </label>

      <button (click)="removeVariationField(i)" type="button">Remove</button>
    </div>

    <button (click)="addVariationField()" type="button">
      + Add Variation Field
    </button>

    <br />
    <button (click)="createVariation()" type="button">Create Variation</button>
  </div>
</div>
