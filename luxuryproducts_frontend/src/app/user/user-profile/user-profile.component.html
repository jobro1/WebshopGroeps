<article class="profile-container">
    <section class="container-leftside">
        <div class="user-card">
            <h2>{{ userInfo()?.firstName }} {{ userInfo()?.lastName }}</h2>
            <div class="user-info">
                <p><strong>{{ 'profile.dateOfBirth' | translate }}:</strong> {{ userInfo()?.dateOfBirth}}</p>
                <p><strong>{{ 'profile.email' | translate }}:</strong> {{ userInfo()?.email }}</p>
                <p><strong>{{ 'profile.phone' | translate }}:</strong> {{ userInfo()?.phoneNumber }}</p>
                <button type="button" class="logout-button" (click)="onLogout()">{{ 'profile.logout' | translate }}</button>
            </div>

            @if (userInfo()?.giftcards && userInfo()?.giftcards!.length > 0) {
                <div class="giftcard-info">
                    <hr />
                    <h4>Gift Cards</h4>
                    <div class="giftcard-tabs">
                        <button
                            [class.active]="activeTab() === 'active'"
                            (click)="switchTab('active')">
                            Active Gift Cards
                        </button>
                        <button
                            [class.active]="activeTab() === 'other'"
                            (click)="switchTab('other')">
                            Other Gift Cards
                        </button>
                    </div>
                    @if (filteredGiftCards.length > 0) {
                        @for (giftcard of filteredGiftCards; track giftcard.id) {
                            <div class="giftcard-item">
                                <p><strong>Card Code:</strong> {{ giftcard.code }}</p>
                                <p><strong>Remaining Balance:</strong> €{{ giftcard.currentBalance | number:'1.2-2' }}</p>
                                <p><strong>Status:</strong> {{ giftcard.status }}</p>
                                <p><strong>Expires:</strong> {{ giftcard.expirationDate | date:'medium' }}</p>
                                <p>_____________________</p>
                                <br>
                            </div>
                        }
                    } @else {
                        <p class="no-cards-message">
                            @if (activeTab() === 'active') {
                                No active gift cards available.
                            } @else {
                                No used, expired, or cancelled gift cards.
                            }
                        </p>
                    }
                </div>
            } @else {
                <p><em>No gift cards associated with this account.</em></p>
            }
        </div>
    </section>

    <section class="container-rightside">
        <h3>{{ 'profile.orderHistory' | translate }}</h3>
        <div class="order-history">
            <ul class="order">
                @for (order of usersOrders(); track order.orderId) {
                    <li>
                        <p class="order-info">
                            <span><strong>{{ 'profile.orderId' | translate }}:</strong> {{ order.orderId }}</span>
                            <span><strong>{{ 'profile.date' | translate }}:</strong> {{ order.date | date:'medium' }}</span>
                            <span><strong>{{ 'profile.status' | translate }}:</strong> {{ order.status }}</span>
                            <span><strong>{{ 'profile.total' | translate }}:</strong> €{{ order.totalPrice | number:'1.2-2' }}</span>
                        </p>
                        <ul class="order-item">
                            @for (orderItem of order.orderItems; track orderItem.orderItemId) {
                                <li>
                                    @if (orderItem.imageUrlAtOrder) {
                                        <img
                                            [src]="orderItem.imageUrlAtOrder"
                                            alt="{{ 'profile.productImageAlt' | translate }}"
                                            width="100"
                                        >
                                    }
                                    <p>
                                        {{ orderItem.sku }} -
                                        {{ 'profile.quantity' | translate }}: {{ orderItem.quantity }} -
                                        {{ 'profile.price' | translate }}: €{{ orderItem.subtotal | number:'1.2-2' }}
                                    </p>
                                    @if (orderItem.variationSummary) {
                                        <p>{{ orderItem.variationSummary }}</p>
                                    }
                                </li>
                            }
                        </ul>
                    </li>
                }
            </ul>
        </div>
    </section>
</article>